---
type: pull_request
state: open
branch: feature/8-sync-sub-issue-relationships → dev
created: 2026-02-20T11:54:42Z
updated: 2026-02-20T11:54:43Z
author: c-vigo
author_url: https://github.com/c-vigo
url: https://github.com/vig-os/sync-issues-action/pull/11
comments: 0
labels: none
assignees: c-vigo
milestone: none
projects: none
relationship: none
synced: 2026-02-20T12:03:15.697Z
---

# [PR 11](https://github.com/vig-os/sync-issues-action/pull/11) feat: sync sub-issue relationships into frontmatter

## Description

Sync GitHub sub-issue relationships (`parentIssue`/`subIssues`) into the markdown frontmatter of synced issue files. Previously the action wrote a hardcoded `relationship: none` for every issue. This PR replaces that with two dynamic fields (`parent`, `children`) populated via a bulk GraphQL query using the `sub_issues` preview API.

## Related Issue(s)

Closes #8

## Type of Change

- [ ] Bug fix (non-breaking change which fixes an issue)
- [x] New feature (non-breaking change which adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
- [ ] Documentation update
- [ ] Refactoring (no functional changes)
- [ ] CI / Build change
- [ ] Test updates

## Changes Made

- **New `IssueRelationship` interface** — `{ parent: number | null; children: number[] }`
- **New `fetchIssueRelationships()` function** — Constructs batched (50 per query) aliased GraphQL queries to fetch `parentIssue` and `subIssues` for all synced issues in a single round-trip. Requires the `GraphQL-Features: sub_issues` header. Gracefully degrades to empty map on error.
- **Updated `syncIssuesToMarkdown()`** — Collects all issue numbers first, fetches relationships in bulk, then passes relationship data to each issue's formatting call.
- **Updated `formatIssueAsMarkdown()`** — Accepts optional `IssueRelationship` parameter; renders `parent: <N|none>` and `children: <N, M|none>` instead of `relationship: none`.
- **Updated PR frontmatter** — Replaced `relationship: none` with `parent: none` and `children: none`.
- **Updated test mock** — Added `graphql: jest.fn()` to the mocked Octokit instance.
- **8 new tests** — 4 formatting tests (parent-only, children-only, both, none), 3 fetch tests (happy path, empty list, error), 1 integration test (relationships in written files).

## Changelog Entry

### Added

- **Sync sub-issue relationships into frontmatter** ([#8](https://github.com/vig-os/sync-issues-action/issues/8))
  - Fetch `parentIssue` and `subIssues` via GraphQL batch query for all synced issues
  - Replace hardcoded `relationship: none` with dynamic `parent` and `children` fields
  - Graceful degradation: falls back to `none` if GraphQL query fails

## Testing

- [x] Tests pass locally (`npm test` — 87 passed, 0 failed)
- [ ] Manual testing performed (describe below)

### Manual Testing Details

Unit tests cover all paths:
- `formatIssueAsMarkdown` with parent-only, children-only, both, and no relationships
- `fetchIssueRelationships` happy path (returns correct map), empty input (no GraphQL call), error handling (warning + empty map)
- Integration: `run()` with mocked GraphQL response verifies `parent: 2` and `children: 10, 11` appear in written file content

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [x] I have commented my code, particularly in hard-to-understand areas
- [ ] I have updated the documentation accordingly (edit `docs/templates/`, then run `just docs`)
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section (and pasted the entry above)
- [x] My changes generate no new warnings or errors
- [x] I have added tests that prove my fix is effective or that my feature works
- [x] New and existing unit tests pass locally with my changes
- [x] Any dependent changes have been merged and published

## Additional Notes

- The issue originally referenced `trackedIssues`/`trackedInIssues` GraphQL fields, but GitHub retired tasklists in April 2025. This PR uses the replacement `subIssues`/`parentIssue` API with the `GraphQL-Features: sub_issues` header.
- The old `relationship` frontmatter field has been removed entirely — it was always `none` and is fully derivable from `parent`/`children`.
- Sub-issues support up to 100 children per parent and 8 nesting levels. The batch query fetches up to 100 children per issue.

Refs: #8
