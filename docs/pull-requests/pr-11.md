---
type: pull_request
state: closed (merged)
branch: feature/8-sync-sub-issue-relationships → dev
created: 2026-02-20T11:54:42Z
updated: 2026-02-20T12:25:01Z
author: c-vigo
author_url: https://github.com/c-vigo
url: https://github.com/vig-os/sync-issues-action/pull/11
comments: 0
labels: none
assignees: c-vigo
milestone: none
projects: none
relationship: none
merged: 2026-02-20T12:24:53Z
synced: 2026-02-20T12:25:15.233Z
---

# [PR 11](https://github.com/vig-os/sync-issues-action/pull/11) feat: sync sub-issue relationships into frontmatter

## Description

Sync GitHub sub-issue relationships (`parentIssue`/`subIssues`) into the markdown frontmatter of synced issue files. Previously the action wrote a hardcoded `relationship: none` for every issue. This PR replaces that with two dynamic fields (`parent`, `children`) populated via a bulk GraphQL query using the `sub_issues` preview API.

## Related Issue(s)

Closes #8

## Type of Change

- [ ] Bug fix (non-breaking change which fixes an issue)
- [x] New feature (non-breaking change which adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
- [ ] Documentation update
- [ ] Refactoring (no functional changes)
- [ ] CI / Build change
- [ ] Test updates

## Changes Made

- **New `IssueRelationship` interface** — `{ parent: number | null; children: number[] }`
- **New `fetchIssueRelationships()` function** — Constructs batched (50 per query) aliased GraphQL queries to fetch `parentIssue` and `subIssues` for all synced issues in a single round-trip. Requires the `GraphQL-Features: sub_issues` header. Gracefully degrades to empty map on error.
- **Updated `syncIssuesToMarkdown()`** — Collects all issue numbers first, fetches relationships in bulk, then passes relationship data to each issue's formatting call.
- **Updated `formatIssueAsMarkdown()`** — Accepts optional `IssueRelationship` parameter; renders `parent: <N|none>` and `children: <N, M|none>` instead of `relationship: none`.
- **Updated PR frontmatter** — Replaced `relationship: none` with `parent: none` and `children: none`.
- **Updated test mock** — Added `graphql: jest.fn()` to the mocked Octokit instance.
- **8 new tests** — 4 formatting tests (parent-only, children-only, both, none), 3 fetch tests (happy path, empty list, error), 1 integration test (relationships in written files).

## Changelog Entry

### Added

- **Sync sub-issue relationships into frontmatter** ([#8](https://github.com/vig-os/sync-issues-action/issues/8))
  - Fetch `parentIssue` and `subIssues` via GraphQL batch query for all synced issues
  - Replace hardcoded `relationship: none` with dynamic `parent` and `children` fields
  - Graceful degradation: falls back to `none` if GraphQL query fails

## Testing

- [x] Tests pass locally (`npm test` — 87 passed, 0 failed)
- [ ] Manual testing performed (describe below)

### Manual Testing Details

Unit tests cover all paths:
- `formatIssueAsMarkdown` with parent-only, children-only, both, and no relationships
- `fetchIssueRelationships` happy path (returns correct map), empty input (no GraphQL call), error handling (warning + empty map)
- Integration: `run()` with mocked GraphQL response verifies `parent: 2` and `children: 10, 11` appear in written file content

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [x] I have commented my code, particularly in hard-to-understand areas
- [ ] I have updated the documentation accordingly (edit `docs/templates/`, then run `just docs`)
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section (and pasted the entry above)
- [x] My changes generate no new warnings or errors
- [x] I have added tests that prove my fix is effective or that my feature works
- [x] New and existing unit tests pass locally with my changes
- [x] Any dependent changes have been merged and published

## Additional Notes

- The issue originally referenced `trackedIssues`/`trackedInIssues` GraphQL fields, but GitHub retired tasklists in April 2025. This PR uses the replacement `subIssues`/`parentIssue` API with the `GraphQL-Features: sub_issues` header.
- The old `relationship` frontmatter field has been removed entirely — it was always `none` and is fully derivable from `parent`/`children`.
- Sub-issues support up to 100 children per parent and 8 nesting levels. The batch query fetches up to 100 children per issue.

Refs: #8


---
---

## Commits

### Commit 1: [199d6db](https://github.com/vig-os/sync-issues-action/commit/199d6db16860747ab8e62a1f5163d5ac89997f09) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:05 AM
test: add failing tests for sub-issue relationship frontmatter, 83 files modified (src/__tests__/unit/index.test.ts)

### Commit 2: [6bb7eb6](https://github.com/vig-os/sync-issues-action/commit/6bb7eb6568de41c06b71b3a391eeb385a1e86f86) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:06 AM
feat: replace relationship field with parent/children in frontmatter, 20 files modified (src/index.ts)

### Commit 3: [6954300](https://github.com/vig-os/sync-issues-action/commit/695430025eafa4724e78173d986e83caf764152f) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:07 AM
test: add failing tests for fetchIssueRelationships, 48 files modified (src/__tests__/unit/index.test.ts)

### Commit 4: [9bfd031](https://github.com/vig-os/sync-issues-action/commit/9bfd031fefed5fab77ae6aed45a44a6c01861db2) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:08 AM
feat: implement fetchIssueRelationships with GraphQL batch queries, 61 files modified (src/__tests__/setup.ts, src/index.ts)

### Commit 5: [7f936b2](https://github.com/vig-os/sync-issues-action/commit/7f936b2d762e5de70bda9ac6913ec265a86b3ed2) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:09 AM
test: add failing integration test for sub-issue relationships in sync, 58 files modified (src/__tests__/unit/index.test.ts)

### Commit 6: [7f1b1ae](https://github.com/vig-os/sync-issues-action/commit/7f1b1ae345e49540b69f33b0cb89059e044e73a4) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:10 AM
feat: wire fetchIssueRelationships into syncIssuesToMarkdown, 60 files modified (src/index.ts)

### Commit 7: [3777215](https://github.com/vig-os/sync-issues-action/commit/37772154c064ee38ffc6d40a2bcb67301cb738ce) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:52 AM
docs: add changelog entry for sub-issue relationship sync, 4 files modified (CHANGELOG.md)

### Commit 8: [c633a40](https://github.com/vig-os/sync-issues-action/commit/c633a408a3639b0cccdf0ad604ff1b0b419bc7fe) by [commit-action-bot[bot]](https://github.com/apps/commit-action-bot) on February 20, 2026 at 12:03 PM
chore: sync issues and PRs, 315 files modified (docs/pull-requests/pr-11.md, docs/pull-requests/pr-5.md, docs/pull-requests/pr-7.md, docs/pull-requests/pr-9.md)

### Commit 9: [03996e3](https://github.com/vig-os/sync-issues-action/commit/03996e3e8058e64562c6c6ebb1c3a18ead7e2d9e) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 12:09 PM
refactor: remove parent/children fields from PR frontmatter, 2 files modified (src/index.ts)

### Commit 10: [60a6a2b](https://github.com/vig-os/sync-issues-action/commit/60a6a2b7cb09103524913c121e2f9e0b814a4479) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 12:18 PM
build: compile dist for sub-issue relationship sync, 408 files modified
